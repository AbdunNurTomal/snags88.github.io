<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Hello, my name is...</title> <meta name="description" content="If you’ve ever worked on a project with me, you know that I love aliasing and renaming things so that code is more legible. One of the latest discoveries I h..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://snags88.github.io/hello-my-name-is"> <link rel="alternate" type="application/rss+xml" title="gem install Seiji" href="http://snags88.github.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="no-style primary-nav"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i> Github</a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i> LinkedIn</a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">Hello, my name is...</h1> <p class="post-meta"><time datetime="2015-05-20T01:51:00-07:00" itemprop="datePublished">May 20, 2015</time></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>If you’ve ever worked on a project with me, you know that I love aliasing and renaming things so that code is more legible. One of the latest discoveries I had was that you can alias join tables so your code makes more sense when you read it out loud.</p> <h3 id="scenario">Scenario</h3> <p>Let’s say that I’m creating an app where a user can own a playlist and also contribute to other user’s playlists. Our schema might look something like below:</p> <p><img style="margin: 0 auto; display: block;" src="https://dl.dropboxusercontent.com/u/16107869/playlistuser.png" alt="playlistuser" width="400" height="auto" /></p> <p>A <strong>user</strong> has many <strong>playlists</strong> through the <strong>owner_id</strong> foreign key, but they also make many <strong>contributions</strong> to <strong>playlists</strong> through the <strong>playlist_user </strong> join table. Vice versa, a <strong>playlist</strong> has an <strong>owner</strong> through their <strong>owner_id</strong> foreign key, but they also have many <strong>contributors</strong> through the <strong>playlist_user</strong> join table.</p> <h3 id="implementation">Implementation</h3> <p>There’s actually two steps in implementing the relationship I previously described. The first is to create a direct relationship between the users and playlists through the owner_id foreign key. This can be done by setting up <strong>has_many</strong> and <strong>belongs_to</strong> relation:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Playlist</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:owner</span><span class="p">,</span> <span class="ss">class_name: </span><span class="s2">"User"</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:playlists</span><span class="p">,</span> <span class="ss">:foreign_key</span> <span class="o">=&gt;</span> <span class="s1">'owner_id'</span>
<span class="k">end</span></code></pre></figure> <p>Now we can call something like:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">playlist</span><span class="p">.</span><span class="nf">owner</span> <span class="c1">#=&gt; returns the current playlist's owner</span>
<span class="n">user</span><span class="p">.</span><span class="nf">playlists</span> <span class="c1">#=&gt; returns the user's playlists that they own/created</span></code></pre></figure> <p>The next step is to alias the <strong>has_many through</strong> relation with the join table. It turns out it’s pretty straight forward. You just have to declare the <strong>has_many</strong> with whatever alias you want to give the association, <strong>through</strong> the join table, and then specify the <strong>source</strong>, which is the table you want to join to. In this specific case, our code will look as follows:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Playlist</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:playlist_users</span>
  <span class="n">has_many</span> <span class="ss">:contributors</span><span class="p">,</span> <span class="ss">through: :playlist_users</span><span class="p">,</span> <span class="ss">source: :user</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:playlist_users</span>
  <span class="n">has_many</span> <span class="ss">:contributions</span><span class="p">,</span> <span class="ss">through: :playlist_users</span><span class="p">,</span> <span class="ss">source: :playlist</span>
<span class="k">end</span></code></pre></figure> <p>This association will now allow us to call things like:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">playlist</span><span class="p">.</span><span class="nf">contributors</span> <span class="c1">#=&gt; returns the list of users that are allowed to contribute to the playlist</span>
<span class="n">user</span><span class="p">.</span><span class="nf">contributions</span> <span class="c1">#=&gt; returns the list of playlists the the user does not own, but can contribute to</span></code></pre></figure> <p>Cool! Now our code is a little bit more legible thanks to a few extra configurations. Until next time, happy coding!</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2018 All rights reserved. Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/nandomoreirame/dotX" target="_blank">dotX</a> theme.</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html>