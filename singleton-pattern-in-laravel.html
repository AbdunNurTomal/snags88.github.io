<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>The Singleton Pattern in Laravel</title> <meta name="description" content="Alright, next up in the creational design patterns is the singletonpattern. Its pretty easy to remember this one. The singleton pattern iswhen a class has a ..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://snags88.github.io/singleton-pattern-in-laravel"> <link rel="alternate" type="application/rss+xml" title="gem install Seiji" href="http://snags88.github.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="no-style primary-nav"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i> Github</a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i> LinkedIn</a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">The Singleton Pattern in Laravel</h1> <p class="post-meta"><time datetime="2018-05-19T10:51:00-07:00" itemprop="datePublished">May 19, 2018</time></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>Alright, next up in the creational design patterns is the singleton pattern. Its pretty easy to remember this one. The singleton pattern is when a class has a single instance of itself. Meaning that whenver I want to use an instance of the class, I‚Äôm using the same instance.</p> <h2 id="singleton-pattern">Singleton Pattern</h2> <p>The implementation of the singleton pattern varies based on the language. I remember for Ruby, there‚Äôs a built in <code class="highlighter-rouge">Singleton</code> module that you can just mixin to a class and it‚Äôll become a singleton.</p> <p>For PHP, it‚Äôs a little bit more complicated. Digging around, I found that the typical way to implement the singleton pattern is to create a singleton trait (basically a Ruby module) that can be used by any class that wants to be a singleton.</p> <p>The singleton trait might look something like this:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="nx">trait</span> <span class="nx">Singleton</span> <span class="p">{</span>
   <span class="k">protected</span> <span class="k">static</span> <span class="nv">$instance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

  <span class="sd">/** call this method to get instance */</span>
   <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">instance</span><span class="p">(){</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">===</span> <span class="kc">null</span><span class="p">){</span>
         <span class="k">static</span><span class="o">::</span><span class="nv">$instance</span> <span class="o">=</span> <span class="k">new</span> <span class="k">static</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="nv">$instance</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="sd">/** protected to prevent cloning */</span>
  <span class="k">protected</span> <span class="k">function</span> <span class="nf">__clone</span><span class="p">(){</span>
  <span class="p">}</span>

  <span class="sd">/** protected to prevent instantiation from outside of the class */</span>
  <span class="k">protected</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(){</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>Most notably, the singleton trait implements the constructor and clone function as protected. It also uses a static variable to hold the single instance of the class. The only way to get an instance of this object is by using the static <code class="highlighter-rouge">instance</code> method: <code class="highlighter-rouge">MyClass::instance()</code>.</p> <p>So why all the fuss about singletons? Its useful for when a class has some configuration that it registers and never changes for the duration of its existance. For example, if I have a class that talks to GitHub‚Äôs API, I probably designed it so that you can pass in configurations to its constructor like my API key and version. The rest of the interface on the client object would just accept paramters to make API calls and return the response. Thus, it‚Äôs unnecessary to instantiate multiple copies of this class.</p> <p>One downside to keep in mind is that these instances are held in memory so they will never get garbage collected. If you have a ton of singletons, you might be holding on to a lot of unnecessary memory space.</p> <h2 id="singleton-pattern-in-the-wild-">Singleton Pattern in the Wild üïµÔ∏è</h2> <p>In the world of Laravel, there is a concept of Service Containers. You can read more about them in their <a href="https://laravel.com/docs/5.6/container" target="_blank">official documentation</a>.</p> <p>The tl;dr of Service Containers is that at the application‚Äôs boot, you can register and bind various classes to the service container (via service providers) to be resolved elsewhere in your app. For example, one of the things you can do is register a class and have it injected into other places like your controller‚Äôs constructor or actions. You just type hint the class you want and BAM! the registered class is injected into your function. Dependency injection FTW:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// binding a class to the service container
</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="nx">MyAwesomeClass</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">MyAwesomeClass</span><span class="p">();</span>
<span class="p">});</span>


<span class="c1">// in a controller somewhere in your app...
</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">show</span><span class="p">(</span><span class="nx">MyAwesomeClass</span> <span class="nv">$awesomeThing</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// ...
</span>
<span class="p">}</span></code></pre></figure> <p>One thing to note about the implementation of the service container in Laravel is that it uses a <code class="highlighter-rouge">Container</code> singleton object to keep track of all the bindings/instances that have been registered/resolved for the app. This actually makes a lot of sense because we have 1 app so we should have 1 container for the app. In fact, the <code class="highlighter-rouge">Container</code> singleton object implements the singleton pattern we wrote out in the previous section. You can see it in the source code <a href="https://github.com/laravel/framework/blob/b8e2cd03663bad9cf91342b641ca96573b06dd0f/src/Illuminate/Container/Container.php#L1171-L1178" target="_blank">here</a></p> <p>Funny thing is that I actually set out write about how you can bind singletons to Laravel‚Äôs service container, but while I was digging through the <code class="highlighter-rouge">Container</code> object in the framework‚Äôs source code, I found that it uses the singleton pattern. That‚Äôs pretty neat that I was able to recognize the pattern now that I‚Äôve seen it written in PHP. Well, that‚Äôs all I have for now. Happy coding!</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2018 All rights reserved. Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/nandomoreirame/dotX" target="_blank">dotX</a> theme.</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html>