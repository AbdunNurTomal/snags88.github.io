<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Backbone to React: Learn.co's Track Nav</title> <meta name="description" content="Last week, I attended a React meetup where I listened to three speakers (onefrom Pinterest, another from NPR, and the last from OpenTable) talkabout their st..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://snags88.github.io/backbone-to-react-learn-cos-track-nav"> <link rel="alternate" type="application/rss+xml" title="gem install Seiji" href="http://snags88.github.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="no-style primary-nav"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i> Github</a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i> LinkedIn</a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">Backbone to React: Learn.co's Track Nav</h1> <p class="post-meta"><time datetime="2017-03-13T05:30:00-07:00" itemprop="datePublished">Mar 13, 2017</time></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>Last week, I attended a React meetup where I listened to three speakers (one from Pinterest, another from NPR, and the last from OpenTable) talk about their stories of migrating their web applications from Backbone.js to React.js. The day after, I was put on a project to reskin/rewrite a part of our site’s navigation header: the Track Nav. It seemed like a good chance to flex my newly acquired knowledge to determine if I should rewrite our Track Nav in React.</p> <h2 id="background">Background</h2> <p>A few things to know about our Track Nav is that:</p> <ul> <li>It’s a 4 level tree hierarchy</li> <li>The node data is represented by a Backbone model, which has an attribute called <code class="highlighter-rouge">children</code> that is a Backbone collection of Backbone models.</li> <li>It shares the models with other Backbone apps on the website.</li> <li>It’s rendered using nested Backbone/Marionette views with some custom JS scripts to make it show up on our page.</li> <li>It also happens to be a bottleneck on our page’s initial load because Backbone is rendering all of the views for each node of the tree upfront.</li> </ul> <p>Here’s what the nav looks like:</p> <p><img style="margin: 0 auto;" width="481" alt="screen shot 2017-03-13 at 8 47 30 pm" src="https://cloud.githubusercontent.com/assets/9381931/23885107/74d9dbd4-082e-11e7-9328-b9d2ae99dd1f.png" /></p> <p>As I dug into this part of our code more, it became apparent that we have some of the Track Nav state on the DOM in data attributes as well as in the Backbone models/collections.</p> <p>Given the information above, I definitely wanted to do a spike on rewriting the Track Nav in React to see if we could address some of the pain points involved with maintaining and updating the Track Nav.</p> <h2 id="strategy">Strategy</h2> <p>As I approached this, there were a few things I wanted to do and not do:</p> <ul> <li>I wanted to improve the page load time by deferring the rendering until you opened the Track Nav.</li> <li>I did not want to maintain and sync two sets of data on the client side for the Backbone apps and the React app.</li> <li>I wanted to make the source code easier to follow.</li> </ul> <p>With the three objectives above, I decided to only rewrite the Backbone views as React components. If we want to rewrite the rest of the site, that is probably the right time to bring in the Flux architecture and completely replace the Backbone infrastructure.</p> <p>In order to swap out the Backbone template rendering with React components, I just followed these steps:</p> <ul> <li>Find the entry point or the top level Backbone view and overwrite the <code class="highlighter-rouge">render</code> function. For us this was in the <code class="highlighter-rouge">TrackNavView</code> view.</li> </ul> <figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">'react'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">ReactDOM</span> <span class="nx">from</span> <span class="s1">'react-dom'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">Backbone</span> <span class="nx">from</span> <span class="s1">'backbone'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">AReactComponent</span> <span class="nx">from</span> <span class="s1">'./a-react-component.jsx'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">TrackNavView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="na">render</span><span class="p">:</span> <span class="kd">function</span> <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">FEATURE</span> <span class="nx">IS</span> <span class="nx">ON</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">component</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span>
        <span class="nx">AReactComponent</span><span class="p">,</span>
        <span class="p">{</span> <span class="na">model</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span> <span class="p">}</span> <span class="c1">// Pass in your props here</span>
      <span class="p">)</span>

      <span class="c1">// Unmount existing react component on rerenders</span>
      <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">unmountComponentAtNode</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>

      <span class="c1">// Render the React Component</span>
      <span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">component</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Just default back to the original render funciton of Backbone View</span>
      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">render</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span></code></pre></figure> <ul> <li>Rewrite your Backbone template in JSX. For any view related helpers, like labels or class names, port them over to the React component.</li> <li>For any behavior related functions (<code class="highlighter-rouge">onClick</code>, etc.), you can pass them in as props to the React component. This way, the only way you’re interacting with the external data is through the existing functions on your Backbone view.</li> </ul> <h2 id="results">Results</h2> <p>With the above steps, let’s take a quick look at how we did against our goals.</p> <h4 id="improve-page-load-time">Improve page load time</h4> <p>As I mentioned before, we configured Backbone to render the entire tree view upfront. You can see that occuring on the large green section in the screenshot below.</p> <p><img width="1524" alt="screen shot 2017-03-13 at 8 29 27 pm" src="https://cloud.githubusercontent.com/assets/9381931/23886574/49a36b50-0839-11e7-8a69-e98433298e16.png" /></p> <p>Here’s the timeline after we rewrote it in React to defer the rendering until the user clicks to open the nav. The entire process of rendering the nav is no where to be seen! (Note that the timeline magnification is large in the screenshot below)</p> <p><img width="1552" alt="screen shot 2017-03-13 at 8 27 40 pm" src="https://cloud.githubusercontent.com/assets/9381931/23886572/46a37206-0839-11e7-8a47-33c25ed555f5.png" /></p> <h4 id="maintain-only-1-dataset">Maintain only 1 dataset</h4> <p>Since we passed in the Backbone model and collections as props, any changes to them from other apps cause the React components to rerender if necessary.</p> <h4 id="easier-source-code">Easier source code</h4> <p>One of the features of Backbone/Marionette is that it can automatically render collection of views based on a Backbone collection. This is usually a great feature, but when its being used for a hierarchy where some of the nodes like the leaf nodes are displayed and interacted with differently, it can be hard to follow the code.</p> <p>In the React rewrite, I ended up with components specific to each node level with the different states of the node (i.e. active, open, completed, in progress) written declaratively. It was much easier than manipulating the data attributes of the DOM elements and having to match up the CSS styles based on data attributes.</p> <h2 id="conclusion">Conclusion</h2> <p>When rewriting a part of your app, it’s always important to consider the time investment you’re making and the benefits that will come with the rewrite. In this particular case, I think the day to rewrite the code was well worth it and hopefully we can extend this strategy to other parts of our app to eventually have a fully React web app. That’s all I got for now. Until next time, happy coding!</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2018 All rights reserved. Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/nandomoreirame/dotX" target="_blank">dotX</a> theme.</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html>