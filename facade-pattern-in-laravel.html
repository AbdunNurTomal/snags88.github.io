<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>The Facade Pattern in Laravel</title> <meta name="description" content="Next up on the structural pattern is the Facade pattern. Supposedly,it derives its name from the word facade, which (according to Google) means:"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://snags88.github.io/facade-pattern-in-laravel"> <link rel="alternate" type="application/rss+xml" title="gem install Seiji" href="http://snags88.github.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="no-style primary-nav"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i> Github</a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i> LinkedIn</a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">The Facade Pattern in Laravel</h1> <p class="post-meta"><time datetime="2018-06-02T13:51:00-07:00" itemprop="datePublished">Jun 2, 2018</time></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>Next up on the structural pattern is the <em>Facade</em> pattern. Supposedly, it derives its name from the word facade, which (according to Google) means:</p> <ol> <li>the face of a building, especially the principal front that looks onto a street or open space.</li> <li>an outward appearance that is maintained to conceal a less pleasant or creditable reality.</li> </ol> <p>I‚Äôm a fan of definition #2 there because it really describes the purpose of the facade pattern in layman‚Äôs terms.</p> <h2 id="facade-pattern">Facade Pattern</h2> <p>Understandably, the facade pattern is often confused with the adapter pattern because you‚Äôre using a class to present a less complex API to the outside word. However, I think one of the biggest differences is that the facade pattern can actually encapsulate many classes that are coordinating together to accomplish a complex task.</p> <p>For example, we could start with an interface that enforces the facade:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">interface</span> <span class="nx">FastFoodFacade</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">orderComboOne</span><span class="p">();</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">orderComboTwo</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure> <p>Then we might have classes that implements the interface that coordinates various classes:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">class</span> <span class="nc">McDonalds</span> <span class="k">implements</span> <span class="nx">FastFoodFacade</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">orderComboOne</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$food</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">McDouble</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">withCheese</span><span class="p">();</span>
        <span class="nv">$drink</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Drink</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">size</span><span class="p">(</span><span class="s1">'large'</span><span class="p">);</span>
        <span class="nv">$fries</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Fries</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">size</span><span class="p">(</span><span class="s1">'large'</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'food'</span> <span class="o">=&gt;</span> <span class="nv">$food</span><span class="p">,</span>
            <span class="s1">'drink'</span> <span class="o">=&gt;</span> <span class="nv">$drink</span><span class="p">,</span>
            <span class="s1">'extra'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">$fries</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">orderComboTwo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$food</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">McNuggets</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
        <span class="nv">$drink</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Drink</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">size</span><span class="p">(</span><span class="s1">'medium'</span><span class="p">);</span>
        <span class="nv">$sauce</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Sauce</span><span class="p">(</span><span class="s1">'Bbq'</span><span class="p">));</span>
        <span class="nv">$sauce2</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Sauce</span><span class="p">(</span><span class="s1">'honeyMustard'</span><span class="p">));</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">'food'</span> <span class="o">=&gt;</span> <span class="nv">$food</span><span class="p">,</span>
            <span class="s1">'drink'</span> <span class="o">=&gt;</span> <span class="nv">$drink</span><span class="p">,</span>
            <span class="s1">'extra'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">$sauce</span><span class="p">,</span> <span class="nv">$sauce2</span><span class="p">]</span>
        <span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <p>We could extend this pattern to another class like <code class="highlighter-rouge">Arbys</code> and implement the same type of facade. When the outside world is interacting with any fastfood class, we know that we can order combo meal #1 or combo meal #2.</p> <h2 id="facade-pattern-in-the-wild-">Facade Pattern in the Wild üïµÔ∏è</h2> <p>If you‚Äôve been using Laravel for sometime, you probably noticed things called Facades exist in Laravel. They are in <code class="highlighter-rouge">Illuminate\Support\Facades\..</code> and many of the common tools in the framework like <code class="highlighter-rouge">Queue</code>, <code class="highlighter-rouge">Job</code>, and <code class="highlighter-rouge">Event</code> are called through these facades.</p> <p>I‚Äôv been using these facades, but didn‚Äôt really dig into them until I started writing this and here‚Äôs how they work.</p> <p>All facades inherit from the abstract facade class in <a href="https://github.com/laravel/framework/blob/5.6/src/Illuminate/Support/Facades/Facade.php" target="_blank"><code class="highlighter-rouge">Illuminate\Support\Facades\Facade</code></a>. That particular abstract class implements a lot of test helpers that allow you to mock out the facade like <code class="highlighter-rouge">shouldReceive</code> or <code class="highlighter-rouge">spy</code>. The other important part is that it also defines a delegation function for any missing static functions called on the class:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">__callStatic</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$instance</span> <span class="o">=</span> <span class="k">static</span><span class="o">::</span><span class="na">getFacadeRoot</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$instance</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">RuntimeException</span><span class="p">(</span><span class="s1">'A facade root has not been set.'</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$instance</span><span class="o">-&gt;</span><span class="nv">$method</span><span class="p">(</span><span class="o">...</span><span class="nv">$args</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure> <p>For any missing static functions, the above function will try to forward the method to the instance to whatever is being facaded (is that even a word? üòÇ).</p> <p>Finally, the concrete facade classes implements the abstract class and needs to define one method at the minimum called <code class="highlighter-rouge">getFacadeAccessor</code>. That function should return the string name of the object as it has been registered in the service provider.</p> <p>Lets take a look at the <code class="highlighter-rouge">Queue</code> facade for example. This is the implementation of <code class="highlighter-rouge">getFacadeAccessor</code>:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getFacadeAccessor</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="s1">'queue'</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> <p>And in <code class="highlighter-rouge">QueueServiceProvider</code> we see that that the <code class="highlighter-rouge">QueueManager</code> gets registered to the app container as <code class="highlighter-rouge">queue</code>:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">protected</span> <span class="k">function</span> <span class="nf">registerManager</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">singleton</span><span class="p">(</span><span class="s1">'queue'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$app</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">tap</span><span class="p">(</span><span class="k">new</span> <span class="nx">QueueManager</span><span class="p">(</span><span class="nv">$app</span><span class="p">),</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$manager</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">registerConnectors</span><span class="p">(</span><span class="nv">$manager</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span></code></pre></figure> <p>What‚Äôs really cool is that you can build onto this pattern and create your own facades in your app or as a library. One of the libraries we use called <a href="https://docs.bugsnag.com/platforms/php/laravel/" target="_blank">Bugsnag</a> implements its own facade so we can easily use its functionality without having to reach into the app container all the time.</p> <p>Apparently some people don‚Äôt consider this to be a real facade pattern, but I feel like it does coordinate complex interactions behind the scenes so that we can easily use the tools that Laravel provides for us. There no need to resolve the queue manager every time we want to use it.</p> <p>Well hopefully that gave some insight to the facade pattern in OOP and the facade concept in Laravel. Until next time, happy coding! üòé</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2018 All rights reserved. Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/nandomoreirame/dotX" target="_blank">dotX</a> theme.</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html>