<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Creating an NPM library with Webpack</title> <meta name="description" content="I’m technically on vacation, but hey, it’s all good. It’s more relaxingto learn about programming related stuff instead of going on massivetours to Stoneheng..."> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://snags88.github.io/creating-an-npm-library-with-webpack"> <link rel="alternate" type="application/rss+xml" title="gem install Seiji" href="http://snags88.github.io/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="no-style primary-nav"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i> Github</a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i> LinkedIn</a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i> Twitter</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">Creating an NPM library with Webpack</h1> <p class="post-meta"><time datetime="2016-11-20T04:30:00-08:00" itemprop="datePublished">Nov 20, 2016</time></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <p>I’m technically on vacation, but hey, it’s all good. It’s more relaxing to learn about programming related stuff instead of going on massive tours to Stonehenge. Anywho, I had a need to learn how to publish an NPM library so I figured I’d jot down the steps I took to get a library published. The library also uses Webpack to build the final source code.</p> <p>It actually turned out way easier than I thought it was going to be. But to make this post a little bit more concise, I’ll assume that you already have Node.js installed. If not, <a href="https://docs.npmjs.com/getting-started/installing-node">here is NPM’s guide</a> on how to do exactly that.</p> <h3 id="configuring-npm">Configuring NPM</h3> <p>The following commands will configure NPM on your local machine so that your information will be added to the <code class="highlighter-rouge">package.json</code> file and published from the correct NPM account:</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="gp">$ </span>npm <span class="nb">set </span>init.author.name <span class="s2">"Optimus Prime"</span>
<span class="gp">$ </span>npm <span class="nb">set </span>init.author.email <span class="s2">"optimus.prime@autobots.com"</span>
<span class="gp">$ </span>npm <span class="nb">set </span>init.author.url <span class="s2">"http://optimus-prime.com"</span>
<span class="gp">$ </span>npm adduser</code></pre></figure> <p>The last command will either prompt you to create a new user in the npm registry or login to an existing one.</p> <h3 id="initialize-your-project-folder">Initialize your project folder</h3> <p>First, create a git project directory with the basic npm configurations:</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="gp">$ </span>mkdir my-library <span class="o">&amp;&amp;</span> <span class="nb">cd </span>my-library
<span class="gp">$ </span>git init
<span class="gp">$ </span>npm init</code></pre></figure> <p>The last command will start a mini-questionnaire to help fill out some details on your <code class="highlighter-rouge">package.json</code> file. This file will contain the configuration for npm to read when we are publishing the library.</p> <p>This is what my first <code class="highlighter-rouge">package.json</code> file looks like. Don’t worry, we’ll continue to develop this file:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">{</span>
  <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"my-library"</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.0"</span><span class="p">,</span>
  <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Example library for my blog post"</span><span class="p">,</span>
  <span class="s2">"main"</span><span class="p">:</span> <span class="s2">"index.js"</span><span class="p">,</span>
  <span class="s2">"scripts"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"test"</span><span class="p">:</span> <span class="s2">"echo </span><span class="se">\"</span><span class="s2">Error: no test specified</span><span class="se">\"</span><span class="s2"> &amp;&amp; exit 1"</span>
  <span class="p">},</span>
  <span class="s2">"keywords"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"example"</span>
  <span class="p">],</span>
  <span class="s2">"author"</span><span class="p">:</span> <span class="s2">"Seiji Naganuma &lt;snaganumas@gmail.com&gt; (https://snags88.github.io/)"</span><span class="p">,</span>
  <span class="s2">"license"</span><span class="p">:</span> <span class="s2">"MIT"</span>
<span class="p">}</span></code></pre></figure> <h3 id="setup-your-project-folder-structure--files">Setup your project folder structure &amp; files</h3> <p>We’re going to need to setup our project folders and files. Keep in mind that we’re going to be using Babel as our transpiler, Webpack as our bundler, and Mocha/Chai as our test runner/assertion library.</p> <p>Here is our project folder structure and a short description of what each folder or file is used for:</p> <figure class="highlight"><pre><code class="language-text" data-lang="text">lib/               =&gt; Output folder of our transpiled code
src/               =&gt; Our source code will all live in this folder
  index.js         =&gt; The main entry point for our bundler
test/              =&gt; Our specs will live here
  index.spec.js    =&gt; Our spec files should end in `*.spec.js`
.babelrc           =&gt; Our Babel configuration file
.gitignore         =&gt; Our project gitignore file
LICENSE            =&gt; Our license file
README.md          =&gt; Our readme file
package.json       =&gt; This file should have been created when we ran `npm init`
webpack.config.js  =&gt; This file will contain our Webpack configuration</code></pre></figure> <h3 id="installing-our-devdependencies">Installing our devDependencies</h3> <p>In the next few commands, we’ll use npm to install all of our dev dependencies and save them to our <code class="highlighter-rouge">package.json</code> file. Back in our terminal, run the following command to install Babel + all its necessary presents/plugins, Webpack, Mocha, and Chai.</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="gp">$ </span>npm install --save-dev babel babel-core babel-loader babel-plugin-add-module-exports babel-preset-es2015
<span class="gp">$ </span>npm install --save-dev webpack mocha chai</code></pre></figure> <p>Note that I split it into two lines just because the command was getting really long. This can be combined into 1 command if you want. I also like to lock the minor version numbers of the libraries I installed so I’ll do that in my <code class="highlighter-rouge">package.json</code> file.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">{</span>
  <span class="c1">#...</span>
  <span class="s2">"devDependencies"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"babel"</span><span class="p">:</span> <span class="s2">"6.5.x"</span><span class="p">,</span>
    <span class="s2">"babel-core"</span><span class="p">:</span> <span class="s2">"6.18.x"</span><span class="p">,</span>
    <span class="s2">"babel-loader"</span><span class="p">:</span> <span class="s2">"6.2.x"</span><span class="p">,</span>
    <span class="s2">"babel-plugin-add-module-exports"</span><span class="p">:</span> <span class="s2">"0.2.x"</span><span class="p">,</span>
    <span class="s2">"babel-preset-es2015"</span><span class="p">:</span> <span class="s2">"6.18.x"</span><span class="p">,</span>
    <span class="s2">"chai"</span><span class="p">:</span> <span class="s2">"3.5.x"</span><span class="p">,</span>
    <span class="s2">"mocha"</span><span class="p">:</span> <span class="s2">"3.1.x"</span><span class="p">,</span>
    <span class="s2">"webpack"</span><span class="p">:</span> <span class="s2">"1.13.x"</span>
  <span class="p">}</span>
  <span class="c1">#...</span>
<span class="p">}</span></code></pre></figure> <h3 id="configuring-babelrc-and-gitignore">Configuring <code class="highlighter-rouge">.babelrc</code> and <code class="highlighter-rouge">.gitignore</code></h3> <p>In <code class="highlighter-rouge">.babelrc</code> specify which presets and plugins you want to use. Here is an example:</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">{</span>
  <span class="s2">"presets"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"es2015"</span><span class="p">],</span>
  <span class="s2">"plugins"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"babel-plugin-add-module-exports"</span><span class="p">]</span>
<span class="p">}</span></code></pre></figure> <p>In <code class="highlighter-rouge">.gitignore</code> include all your favorite files to ignore. But make sure you include the <code class="highlighter-rouge">node_modules</code> folder. Otherwise, all your dependencies will be checked into your repo.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Dependency directories</span>
<span class="n">node_modules</span></code></pre></figure> <h3 id="configuring-webpack">Configuring Webpack</h3> <p>We will quickly update our <code class="highlighter-rouge">webpack.config.js</code> to do a few things:</p> <ul> <li>Know where to find our entry file (<code class="highlighter-rouge">src/index.js</code>)</li> <li>Where to output our transpiled file (<code class="highlighter-rouge">lib/my-library.js</code>)</li> <li>Know what loader to use to transpile our code. Babel in our case.</li> <li>Minify the file depending on the build environment.</li> </ul> <p>Here is what my <code class="highlighter-rouge">webpack.config.js</code> looks like. I won’t get into details of how each thing works, but you can easily look it up on the Webpack documentation.</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">webpack</span>        <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'webpack'</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">path</span>           <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">UglifyJsPlugin</span> <span class="o">=</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">optimize</span><span class="p">.</span><span class="nx">UglifyJsPlugin</span>
  <span class="p">,</span> <span class="nx">env</span>            <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">WEBPACK_ENV</span>
  <span class="p">;</span>

<span class="kd">var</span> <span class="nx">libraryName</span> <span class="o">=</span> <span class="s1">'my-library'</span>
  <span class="p">,</span> <span class="nx">outputFile</span>  <span class="o">=</span> <span class="s1">''</span>
  <span class="p">,</span> <span class="nx">plugins</span>     <span class="o">=</span> <span class="p">[]</span>
  <span class="p">;</span>

<span class="c1">// configure output for proper build type</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">env</span> <span class="o">===</span> <span class="s1">'build'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">plugins</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">UglifyJsPlugin</span><span class="p">({</span> <span class="na">minimize</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>
  <span class="nx">outputFile</span> <span class="o">=</span> <span class="nx">libraryName</span> <span class="o">+</span> <span class="s1">'.min.js'</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">outputFile</span> <span class="o">=</span> <span class="nx">libraryName</span> <span class="o">+</span> <span class="s1">'.js'</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'src'</span><span class="p">,</span><span class="s1">'index.js'</span><span class="p">),</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'lib'</span><span class="p">),</span>
    <span class="na">filename</span><span class="p">:</span> <span class="nx">outputFile</span><span class="p">,</span>
    <span class="na">library</span><span class="p">:</span> <span class="nx">libraryName</span><span class="p">,</span>
    <span class="na">libraryTarget</span><span class="p">:</span> <span class="s1">'umd'</span><span class="p">,</span>
    <span class="na">umdNamedDefine</span><span class="p">:</span> <span class="kc">true</span>
  <span class="p">},</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">(\.</span><span class="sr">jsx|</span><span class="se">\.</span><span class="sr">js</span><span class="se">)</span><span class="sr">$/</span><span class="p">,</span>
        <span class="na">loader</span><span class="p">:</span> <span class="s1">'babel'</span><span class="p">,</span>
        <span class="na">exclude</span><span class="p">:</span> <span class="sr">/</span><span class="se">(</span><span class="sr">node_modules</span><span class="se">)</span><span class="sr">/</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">root</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">'./src'</span><span class="p">),</span>
    <span class="na">extensions</span><span class="p">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'.js'</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure> <h3 id="updating-our-packagejson">Updating our <code class="highlighter-rouge">package.json</code></h3> <p>Since we’ve made changes to our Webpack configuration, let’s make sure that our <code class="highlighter-rouge">package.json</code> is up-to-date.</p> <p>First, let’s change the <code class="highlighter-rouge">main</code> entry to point to the correct file <code class="highlighter-rouge">lib/my-library</code>. This is what will be ultimately used by anyone using our library. See the documentation <a href="https://docs.npmjs.com/files/package.json#main">here</a>.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">{</span>
  <span class="c1">#...</span>
  <span class="s2">"main"</span><span class="p">:</span> <span class="s2">"lib/my-library.js"</span><span class="p">,</span>
  <span class="c1">#...</span>
<span class="p">}</span></code></pre></figure> <p>Next, we’ll want to add some <code class="highlighter-rouge">script</code>s mostly to help bundle our code in dev + production and to run our tests.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="p">{</span>
  <span class="c1">#...</span>
  <span class="s2">"scripts"</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"build"</span><span class="p">:</span> <span class="s2">"WEBPACK_ENV=build webpack"</span><span class="p">,</span>
    <span class="s2">"dev"</span><span class="p">:</span> <span class="s2">"WEBPACK_ENV=dev webpack --progress --colors --watch"</span><span class="p">,</span>
    <span class="s2">"test"</span><span class="p">:</span> <span class="s2">"mocha --compilers js:babel-core/register --colors -w ./test/*.spec.js"</span>
  <span class="p">},</span>
  <span class="c1">#...</span>
<span class="p">}</span></code></pre></figure> <p>Now we can run <code class="highlighter-rouge">$ npm run dev</code> or <code class="highlighter-rouge">$ npm run build</code> to bundle our code. We can also run <code class="highlighter-rouge">$ npm test</code> to run any specs in <code class="highlighter-rouge">test/*.spec.js</code>.</p> <h3 id="publishing-to-npm">Publishing to NPM</h3> <p>After you’ve written your library, some specs, and filled out the <code class="highlighter-rouge">README.md</code> file with some useful information, you’re ready to publish the library. One useful thing to do before you publish is to make sure everything works by installing your current node module globally and testing it in the node repl:</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="gp">$ </span>npm install . -g
<span class="gp">$ </span>node
<span class="gp">&gt; </span>var myLib <span class="o">=</span> require<span class="o">(</span><span class="s1">'myLib'</span><span class="o">)</span>;
<span class="gp">&gt; </span>// use your library here to make sure it works.</code></pre></figure> <p>Once you’ve done that, you can publish it with a really simple command:</p> <figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="gp">$ </span>npm publish</code></pre></figure> <p>And that’s it! Your library is published for the whole world to use. Just install it using <code class="highlighter-rouge">$ npm install my-library</code>.</p> <h3 id="conclusion">Conclusion</h3> <p>Publishing your own libraries to npm is not a hard as I first thought it would be. Since we come across similar problems in web development, it’s nice to share some of the solutions you’ve implemented. If you’d like to see the finished repo, you can find it <a href="https://github.com/snags88/webpack-starter">here</a>.</p> <p>In the next post, I’ll be talking about the implementation behind the first library I published to npm.</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/snags88" target="_blank"><i class="icon icon-github"></i></a></li> <li><a href="http://linkedin.com/in/snaganuma" target="_blank"><i class="icon icon-linkedin"></i></a></li> <li><a href="http://twitter.com/S2k10" target="_blank"><i class="icon icon-twitter"></i></a></li> </ul> <p> <small>&copy;2018 All rights reserved. Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> with <a href="https://github.com/nandomoreirame/dotX" target="_blank">dotX</a> theme.</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html>